+++
title = "An√°lisis de Malware con Volatility"
date = 2026-01-05
draft = false
tags = ["forensics", "malware", "volatility", "memory-analysis"]
categories = ["Labs", "Digital Forensics"]
+++

## üî¨ Descripci√≥n del Lab

Lab pr√°ctico de an√°lisis forense de memoria usando **Volatility 3** para investigar una infecci√≥n de malware en un sistema Windows.

## üéØ Objetivos de Aprendizaje

- Analizar un volcado de memoria (memory dump)
- Identificar procesos maliciosos
- Extraer artefactos del malware
- Documentar la cadena de infecci√≥n

## üèóÔ∏è Configuraci√≥n del Entorno

### Requisitos:
- Volatility 3
- Python 3.8+
- Memory dump de la m√°quina infectada (`.raw` o `.mem`)
- REMnux (opcional pero recomendado)

### Setup:

```bash
# Instalar Volatility 3
git clone https://github.com/volatilityfoundation/volatility3.git
cd volatility3
pip3 install -r requirements.txt

# Verificar instalaci√≥n
python3 vol.py -h
```

## üí° Ejercicios

### Ejercicio 1: Identificar el Sistema Operativo

```bash
python3 vol.py -f infected.raw windows.info
```

**Pregunta**: ¬øQu√© versi√≥n de Windows est√° ejecutando la v√≠ctima?

### Ejercicio 2: Listar Procesos

```bash
python3 vol.py -f infected.raw windows.pslist
python3 vol.py -f infected.raw windows.pstree
```

**Preguntas**:
- ¬øHay procesos con nombres sospechosos?
- ¬øAlg√∫n proceso corriendo desde ubicaciones inusuales?
- ¬øProcesos con PPID (Parent PID) an√≥malos?

### Ejercicio 3: Buscar Procesos Ocultos

```bash
python3 vol.py -f infected.raw windows.pscan
```

**Objetivo**: Detectar rootkits que ocultan procesos.

### Ejercicio 4: Analizar Conexiones de Red

```bash
python3 vol.py -f infected.raw windows.netscan
```

**Buscar**:
- IPs extranjeras sospechosas
- Puertos no est√°ndar
- Conexiones C2 (Command & Control)

### Ejercicio 5: Extraer Ejecutables Sospechosos

```bash
# Listar DLLs cargadas por un proceso
python3 vol.py -f infected.raw windows.dlllist --pid 1234

# Dump del proceso
python3 vol.py -f infected.raw windows.memmap --pid 1234 --dump
```

## ‚úÖ Soluci√≥n

### Hallazgos del An√°lisis

#### 1. Proceso Malicioso Identificado

```
PID: 3428
Nombre: svchost.exe
Path: C:\Users\Admin\AppData\Local\Temp\svchost.exe
PPID: 1892 (explorer.exe)
```

üö® **Red Flags**:
- `svchost.exe` corriendo desde `Temp` (deber√≠a estar en `System32`)
- Hijo directo de `explorer.exe` (ejecuci√≥n manual)
- No hay argumento `-k` (normal en svchost leg√≠timos)

#### 2. Conexi√≥n C2 Detectada

```
IP: 185.234.218.42
Puerto: 443
Estado: ESTABLISHED
Proceso: svchost.exe (PID 3428)
```

#### 3. Persistencia

Registry key encontrada:
```
HKCU\Software\Microsoft\Windows\CurrentVersion\Run
"WindowsUpdate" = "C:\Users\Admin\AppData\Local\Temp\svchost.exe"
```

### IOCs (Indicators of Compromise)

| Tipo | Valor |
|------|-------|
| MD5 | a1b2c3d4e5f6... |
| SHA256 | 9f8e7d6c5b4a... |
| IP C2 | 185.234.218.42 |
| Domain | evil-domain[.]com |
| Registry | HKCU\...\Run\WindowsUpdate |

## üìù Notas y Aprendizajes

### T√©cnicas del Malware

- **Process Masquerading**: Se hace pasar por proceso leg√≠timo de Windows
- **Persistence**: Registry Run key para sobrevivir reinicios
- **C2 Communication**: HTTPS (puerto 443) para pasar desapercibido

### Comandos √ötiles de Volatility

```bash
# L√≠nea de comandos ejecutada
vol.py -f dump.raw windows.cmdline

# Registry hives
vol.py -f dump.raw windows.registry.hivelist

# Buscar en registry
vol.py -f dump.raw windows.registry.printkey --key "Software\Microsoft\Windows\CurrentVersion\Run"

# Strings de un proceso
strings infected.raw | grep -i "http"
```

### Recomendaciones

1. **Nunca analizar en el host infectado** - Usar VM aislada
2. **Hash todo** - Calcular hashes antes de analizar
3. **Documentar timeline** - Orden cronol√≥gico de eventos
4. **Preservar evidencia** - Hacer backup del dump original

## üîó Recursos Adicionales

- [Volatility Cheat Sheet](https://github.com/volatilityfoundation/volatility/wiki)
- [SANS DFIR Cheat Sheets](https://digital-forensics.sans.org/community/cheat-sheets)
- [Malware Archaeology](https://www.malwarearchaeology.com/)

---

‚ö° **Challenge**: ¬øPuedes identificar c√≥mo entr√≥ el malware inicialmente? Pista: revisa los logs del navegador en memoria.
